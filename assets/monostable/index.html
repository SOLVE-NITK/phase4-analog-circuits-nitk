<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SOLVE</title>
  <!-- <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet"> -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" />
  <link rel="stylesheet" href="css/general.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/query.css" />
  <!-- <script defer src="https://code.jquery.com/jquery.min.js"></script> -->
  <script defer src="https://code.jquery.com/jquery-3.7.0.min.js"
    integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script defer src="https://code.jquery.com/ui/1.8.17/jquery-ui.min.js"></script>
  <script defer src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script defer src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <script defer type="text/javascript"
    src="//cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
  <script src="jsplumb.js"></script>
  <script src="demo.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const toggleSwitch = document.getElementById('toggle');
      const simulateButton = document.querySelector('.myButton[onclick="simulateCircuit()"]');
      const resistanceSlider = document.getElementById('myResistance');
      const capacitanceSlider = document.getElementById('myCapacitance');
      const tabulateButton = document.querySelector('.myButton[onclick="toggleTable()"]');
      const greendot = document.getElementById('greendot');
      const graphButton = document.getElementById('graphButton');
      const imageDisplay = document.getElementById('imageDisplay');
      const resistanceValueDisplay = document.getElementById('resistanceValue');
      const capacitanceValueDisplay = document.getElementById('capacitanceValue');

      // Disable the img element
      graphButton.setAttribute('disabled', true);
      graphButton.style.pointerEvents = 'none'; // Disable pointer events to prevent clicks

      // Optionally, you can also adjust the opacity to visually indicate it's disabled
      graphButton.style.opacity = '0.5'; // Adjust opacity as per your design

      // If needed, disable the span element next to it for consistency
      const spanElement = graphButton.nextElementSibling;
      spanElement.style.opacity = '0.5'; // Adjust opacity for the span element

      // Add change event listener to toggle switch
      toggleSwitch.addEventListener('change', function () {
        if (toggleSwitch.checked) {
          // If toggle switch is checked, display greendot
          greendot.style.display = 'inline-block';
        } else {
          // If toggle switch is unchecked, hide greendot
          greendot.style.display = 'none';
          simulateCircuit();
        }
      });

      // Disable Simulate button initially
      simulateButton.disabled = true;
      // Disable Tabulate button initially
      tabulateButton.disabled = true;

      // Event listener for resistance slider change
      resistanceSlider.addEventListener('input', function () {
        document.getElementById('resistanceValue').textContent = this.value;
        updateTableValues(); // Update table on resistance change
        checkEnableButtons();
      });

      // Event listener for capacitance slider change
      capacitanceSlider.addEventListener('input', function () {
        document.getElementById('capacitanceValue').textContent = this.value;
        updateTableValues(); // Update table on capacitance change
        checkEnableButtons();
      });

      function checkEnableButtons() {
        const resistanceValue = parseInt(resistanceSlider.value);
        const capacitanceValue = parseInt(capacitanceSlider.value);

        const validValues = [3, 6, 10];
        const areValuesValid = validValues.includes(resistanceValue) && validValues.includes(capacitanceValue);

        if (areValuesValid) {
          simulateButton.disabled = false; // Enable Simulate button
          tabulateButton.disabled = false; // Enable Tabulate button
          graphButton.removeAttribute('disabled');
          graphButton.style.pointerEvents = 'auto'; // Enable pointer events
          document.getElementById('instructionText').textContent = "Instructions: Click Simulate button to observe output, Tabulate button to note readings in table and Graph button to observe the graph. ";

          // Optionally, reset opacity if needed
          graphButton.style.opacity = '1';

          // If needed, enable the span element next to it for consistency
          spanElement.style.opacity = '1'; // Reset opacity for the span element
        } else {
          simulateButton.disabled = true; // Disable Simulate button
          tabulateButton.disabled = true; // Disable Tabulate button
          graphButton.setAttribute('disabled', true);
          graphButton.style.pointerEvents = 'none'; // Disable pointer events
          graphButton.style.opacity = '0.5'; // Adjust opacity for the graph button
          spanElement.style.opacity = '0.5'; // Adjust opacity for the span element
        }
      }


      const canvas = document.getElementById('myCanvas');
      const ctx = canvas.getContext('2d');

      const DOT_RADIUS = 7;
      const ORANGE_COLOR = 'red';
      const BLACK_COLOR = '#000';

      const fixedDots = [
        { x: 519, y: 172, color: ORANGE_COLOR, label: 'dot 1' }, // dot1
        { x: 578, y: 249, color: BLACK_COLOR, label: 'dot 2' }, // dot 2
        { x: 578, y: 232, color: ORANGE_COLOR, label: 'dot 1' }, // dot 3
        { x: 514, y: 315, color: BLACK_COLOR, label: 'dot 2' }, // dot 4
      ];

      let dragging = false;
      let startDot = null;
      let connections = []; // Array to store connections between dots

      function drawDot(x, y, color) {
        ctx.beginPath();
        ctx.arc(x, y, DOT_RADIUS, 0, 2 * Math.PI);
        ctx.fillStyle = color;
        ctx.fill();
        ctx.closePath();
      }

      function drawLine(startX, startY, endX, endY, color) {
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(endX, endY);
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.closePath();
      }

      function drawFixedDots() {
        fixedDots.forEach(dot => {
          drawDot(dot.x, dot.y, dot.color);
        });
      }

      function connectDots(dot1, dot2) {
        const lineColor = dot1.color;
        drawLine(dot1.x, dot1.y, dot2.x, dot2.y, lineColor);
        connections.push({ start: dot1, end: dot2, color: lineColor });

        // Change the instruction text to "Click on check button"
        document.getElementById('instructionText').textContent = "Instructions: Click on check button";

        // Enable the check button
        document.querySelector('.myButton[onclick="checkCircuit()"]').disabled = false;
        document.querySelector('.myButton[onclick="history.go(0)"]').disabled = false;
      }

      // Event listener for toggle switch change
      toggleSwitch.addEventListener('change', function () {
        if (toggleSwitch.checked) {
          // Enable sliders
          resistanceSlider.disabled = false;
          capacitanceSlider.disabled = false;
        } else {
          simulateButton.disabled = true; // Disable Simulate button
          // Disable sliders
          resistanceSlider.disabled = true;
          capacitanceSlider.disabled = true;
          // Disable Tabulate button when toggles switch is off
          tabulateButton.disabled = true;
        }
      });

      function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawFixedDots();
        connections.forEach(conn => {
          drawLine(conn.start.x, conn.start.y, conn.end.x, conn.end.y, conn.color);
        });
      }

      function findDot(x, y) {
        for (let i = 0; i < fixedDots.length; i++) {
          const dot = fixedDots[i];
          const distance = Math.sqrt((dot.x - x) ** 2 + (dot.y - y) ** 2);
          if (distance <= DOT_RADIUS) {
            return dot;
          }
        }
        return null;
      }

      function dotHasConnection(dot) {
        for (let i = 0; i < connections.length; i++) {
          const conn = connections[i];
          if (conn.start === dot || conn.end === dot) {
            return true;
          }
        }
        return false;
      }

      function handleMouseDown(event) {
        const rect = canvas.getBoundingClientRect();
        const mouseX = event.clientX - rect.left;
        const mouseY = event.clientY - rect.top;

        const clickedDot = findDot(mouseX, mouseY);

        if (clickedDot && !dotHasConnection(clickedDot)) {
          dragging = true;
          startDot = clickedDot;
        }
      }

      function handleMouseMove(event) {
        if (dragging) {
          const rect = canvas.getBoundingClientRect();
          const mouseX = event.clientX - rect.left;
          const mouseY = event.clientY - rect.top;

          clearCanvas();
          drawLine(startDot.x, startDot.y, mouseX, mouseY, startDot.color);
        }
      }

      function handleMouseUp(event) {
        if (dragging) {
          const rect = canvas.getBoundingClientRect();
          const mouseX = event.clientX - rect.left;
          const mouseY = event.clientY - rect.top;

          const endDot = findDot(mouseX, mouseY);

          if (endDot && endDot !== startDot && !dotHasConnection(endDot)) {
            connectDots(startDot, endDot);
          }

          dragging = false;
          startDot = null;
          clearCanvas();
        }
      }

      canvas.addEventListener('mousedown', handleMouseDown);
      canvas.addEventListener('mousemove', handleMouseMove);
      canvas.addEventListener('mouseup', handleMouseUp);

      // Initial drawing of fixed dots
      drawFixedDots();

      // Function to handle displaying text in Controls section when Graph button is clicked
      window.showGraph = function () {
        changeBulbImage(); // Update bulb images and text based on current toggle state
        document.querySelector('.icon-button.graph-button').classList.toggle('active');
        document.querySelector('.graph-div').classList.toggle('display-hide');
      };

      // Define the checkCircuit function
      window.checkCircuit = function () {
        const correctConnections = [
          { start: fixedDots[0], end: fixedDots[2] }, // dot 1 to dot 3
          { start: fixedDots[1], end: fixedDots[3] }, // dot 2 to dot 4
        ];

        let isCorrect = true;

        connections.forEach(conn => {
          if (conn.start.color !== conn.end.color) {
            isCorrect = false;
          }
        });

        if (isCorrect) {
          let allCorrect = true;

          correctConnections.forEach(correctConn => {
            const found = connections.some(conn => {
              return (
                (conn.start === correctConn.start && conn.end === correctConn.end) ||
                (conn.start === correctConn.end && conn.end === correctConn.start)
              );
            });

            if (!found) {
              allCorrect = false;
            }
          });

          if (allCorrect) {
            alert('Right Connections');
            // Disable the check button
            document.querySelector('.myButton[onclick="checkCircuit()"]').disabled = true;
            // Change the instruction text
            document.getElementById('instructionText').textContent = "Instructions: Now, switch position to ON and give the value for resistance and capacitance";
            // Enable the toggle button after checking the circuit
            document.getElementById('toggle').disabled = false;
            // Enable the toggle-wrapper section
            var toggleWrapper = document.getElementById('toggle-wrapper');
            toggleWrapper.classList.remove('disabled');
          } else {
            alert('Complete the Connections');
          }
        } else {
          alert('Wrong Connection' + "\n" + 'Please check the connections');
        }
      };

      window.simulateCircuit = function () {
        const toggle = document.getElementById('toggle');
        const bulbImg = document.getElementById('bulbImg');

        if (toggle.checked) {
          bulbImg.src = 'https://image.ibb.co/cBBaeR/light_bulb_on.png'; // Bulb on
        } else {
          bulbImg.src = 'https://image.ibb.co/hoBxtm/light_bulb_off.png'; // Bulb off
        }
      };

      // Function to update displayed values
      function updateTableValues() {
        const resistanceValue = document.getElementById('myResistance').value;
        const capacitanceValue = document.getElementById('myCapacitance').value;

        // Calculate Ton value
        const tonValue = ((1.1 * resistanceValue * Math.pow(10, 3)) * (capacitanceValue * Math.pow(10, -6))) * 1000;
      }

      // Initialize a counter to keep track of rows added
      let rowCount = 0;

      // Function to add a new row to the table
      function addTableRow() {
        if (rowCount >= 10) {
          alert("Cannot add more values. Limit reached.");
          return;
        }

        const resistanceValue = document.getElementById('myResistance').value;
        const capacitanceValue = document.getElementById('myCapacitance').value;
        const tonValue = ((1.1 * resistanceValue * Math.pow(10, 3)) * (capacitanceValue * Math.pow(10, -6))) * 1000;

        const tableBody = document.getElementById('experimental-table-body');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
      <td>${resistanceValue}</td>
      <td>${capacitanceValue}</td>
      <td>${tonValue.toFixed(2) + " msec"}</td>
    `;
        tableBody.appendChild(newRow);

        rowCount++; // Increment row count after adding a row
      }

      // Event listener for Tabulate button click
      tabulateButton.addEventListener('click', function () {
        addTableRow();
      });

      // Initialize image paths for each scenario
      const images = {
        '3-3': 'images/33.png',
        '3-6': 'images/36.png',
        '3-10': 'images/310.png',
        '6-3': 'images/36.png',
        '6-6': 'images/66.png',
        '6-10': 'images/610.png',
        '10-3': 'images/310.png',
        '10-6': 'images/610.png',
        '10-10': 'images/1010.png',
      };

      // Function to update displayed values of sliders
      function updateSliderValues() {
        resistanceValueDisplay.textContent = resistanceSlider.value;
        capacitanceValueDisplay.textContent = capacitanceSlider.value;
      }

      // Initial update of slider values
      updateSliderValues();

      // Event listener for button click
      graphButton.addEventListener('click', function () {
        const resistanceValue = parseInt(resistanceSlider.value);
        const capacitanceValue = parseInt(capacitanceSlider.value);

        // Construct key to look up in images object
        const key = `${resistanceValue}-${capacitanceValue}`;

        // Check if key exists in images object
        if (images.hasOwnProperty(key)) {
          // Set image source based on key
          imageDisplay.src = images[key];
        } else {
          // If no matching image found, clear image display
          imageDisplay.src = '';
        }
      });

      // Initial check for enabling buttons
      checkEnableButtons();
    });

  </script>
  <style>
  </style>

  <script defer src="js/script.js"></script>
</head>

<body>
  <!-- Logo -->
  <!-- Experiment Title -->
  <!-- Tools Sections -->
  <!-- Tools Container -->
  <!-- Simulation Container -->
  <div class="title-div-container">

    <div class="title-div">
      <!-- <span class="round left-top"></span>
          <span class="round left-bottom"></span>
          <span class="round right-top"></span>
          <span class="round right-bottom"></span> -->
      <div class="logo-div">
        <a href="#"><img src="images/logo_nitk.png" alt="Logo" class="logo" /></a>
      </div>
      <h1>Monostable Multivibrator</h1>
    </div>
  </div>
  <div class="container">
    <div class="sidebar">
      <ul class="tool-menu">
        <li class="tool-list">
          <a href="#simulation" class="tool-link" title="Simulation"><svg xmlns="http://www.w3.org/2000/svg"
              fill="#089B93" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" class="icons">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3 8.25V18a2.25 2.25 0 002.25 2.25h13.5A2.25 2.25 0 0021 18V8.25m-18 0V6a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 6v2.25m-18 0h18M5.25 6h.008v.008H5.25V6zM7.5 6h.008v.008H7.5V6zm2.25 0h.008v.008H9.75V6z" />
            </svg>
          </a>
          <span>Simulation</span>
        </li>
        <li class="tool-list">
          <a href="#variables" class="tool-link" title="Variables"><svg xmlns="http://www.w3.org/2000/svg"
              fill="#ffffff" viewBox="0 0 24 24" stroke-width="1.5" stroke="#089B93" class="icons">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M4.745 3A23.933 23.933 0 003 12c0 3.183.62 6.22 1.745 9M19.5 3c.967 2.78 1.5 5.817 1.5 9s-.533 6.22-1.5 9M8.25 8.885l1.444-.89a.75.75 0 011.105.402l2.402 7.206a.75.75 0 001.104.401l1.445-.889m-8.25.75l.213.09a1.687 1.687 0 002.062-.617l4.45-6.676a1.688 1.688 0 012.062-.618l.213.09" />
            </svg></a>
          <span>Variables</span>
        </li>
        <li class="tool-list" onclick="displayEquations()">
          <a href="#comments" class="tool-link" title="Comments"><svg xmlns="http://www.w3.org/2000/svg" fill="#089B93"
              viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" class="icons">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg></a>
          <span>Results</span>
        </li>
        <li class="tool-list">
          <img style="cursor: pointer;" id="graphButton" src="./images/graphbutton.svg" alt="" class="icons" disabled />
          <span>Graph</span>
        </li>
      </ul>
    </div>

    <div class="main">
      <div class="main-section">
        <div id="simulation" class="main__task-div">
          <!-- <div id="controls" class="div__control">
              <img id="playpausebutton" onclick="simstate()" src="./images/blueplaydull.svg" alt="" />
              <img id="graphbutton" onclick="plotgraph()" src="./images/graphbutton.svg" alt="" />
            </div> -->
          <div>
            <header class="header-bar">
              <div class="header-title">Simulation</div>
            </header>
          </div>
          <div class="canvas__div">
            <p style="margin-left: 20px;" id="instructionText">Instructions: Complete the circuit connection.</p>
            <div id="canvas-container">
              <div style="position: absolute;">
                <img src="images/555 Timer.png" alt="Circuit Diagram" class="circuit-diagram" width="450px"
                  height="400px" style="margin-left: 10px;">
              </div>
              <div style="position: absolute; margin-top: 368px; margin-right: 14px;">
                <img id="greendot" src="images/greendot.png" width="15px" height="15px" style="display: none;">
              </div>
              <div style="position: relative;">
                <canvas id="myCanvas" width="600" height="400"></canvas>
              </div>
              <div>
                <img id="bulbImg" src="https://image.ibb.co/hoBxtm/light_bulb_off.png" alt="Blub">
              </div>
              <div id="led1" class="led" style="display: none;"></div>
              <div id="led2" class="led" style="display: none;"></div>
            </div>
            <!--
            <div class="graph-div display-hide">
              <canvas id="graphscreen1" class="canvas">
              </canvas>
            </div>
            -->
          </div>
        </div>

        <div id="variables" class="main__task-div">
          <div class="settings-sections">
            <h3 class="task-title">Variables</h3>
            <div id="toggle-wrapper" class="variables-sections disabled">
              <div class="switch">
                <label>Switch position</label>
                <div class="toggle-wrapper">
                  <h3 class="off">OFF</h3>
                  <input type="checkbox" id="toggle" class="toggle-checkbox" disabled />
                  <label for="toggle" class="toggle-label">
                    <span class="toggle-inner"></span>
                    <span class="toggle-switch"></span>
                  </label>
                  <h3 class="on">ON</h3>
                </div>
              </div>
              <div class="slidecontainer">
                <h3 style="font-size: 17px;">Resistance, R: <br>(kΩ)</h3>
                <input type="range" min="0" max="10" step="0.01" value="0" id="myResistance" class="slider" disabled>
                <span id="resistanceValue">0</span> <!-- Display the resistance value here -->
              </div>

              <div class="slidecontainer">
                <h3 style="font-size: 17px;">Capacitance, C: <br>(μF)</h3>
                <input type="range" min="0" max="10" step="0.01" value="0" id="myCapacitance" class="slider" disabled>
                <span id="capacitanceValue">0</span> <!-- Display the capacitance value here -->
              </div>
            </div>
          </div>
        </div>

        <div id="comments" class="main__task-div">
          <h3 class="task-title">Controls</h3>
          <div class="settings-sections">
            <button class="myButton" onclick="checkCircuit()" disabled>Check</button>
            <button class="myButton" onclick="simulateCircuit()">Simulate</button>
            <button class="myButton" onclick="toggleTable()">Tabulate</button>
            <button class="myButton" onClick="history.go(0)" disabled>Reset</button>
            <!--
            <button class="myButton" onclick="changeBulbImage()" disabled>Graph</button>
            -->
          </div>
        </div>

        <div id="graph" class="main__task-div">
          <h3 class="task-title">Results</h3>
          <div class="settings-sections">
            <table id="experimental-readings" style="display: none; margin-bottom: 20px; width: 50%;">
              <thead>
                <tr>
                  <th colspan="5">Experimental Readings</th>
                </tr>
                <tr>
                  <th>Resistor, R<br>(kΩ)</th>
                  <th>Capacitance, C<br>(μF)</th>
                  <th>Ton = 1.1RC<br>(msec)</th>
                </tr>
              </thead>
              <tbody id="experimental-table-body">
                <tr>
                  <td id="resistorValue"></td>
                  <td id="capacitorValue"></td>
                  <td id="tonValue"></td>
                </tr>
              </tbody>
            </table>
            <div id="imageContainer">
              <img id="imageDisplay" src="" alt="Image Display" style="    margin-top: 50px;
              height: 800px;
              margin-left: 10%;">
            </div>
          </div>
        </div>
        <div class="main__task-div footer">
          <p>Copyright © SOLVE The Virtual Lab @ NITK Surathkal</p>
        </div>
      </div>
    </div>
  </div>
</body>

</html>